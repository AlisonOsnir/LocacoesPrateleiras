<!DOCTYPE html>
<meta charset="UTF-8">
<html lang="pt-br">

<head>
  <title>Locações PTH</title>
  <link rel="stylesheet" href="style.css">

</head>

<body>
  <main>
    <h1 class="tituloPrincipal">LOCAÇÕES PTH</h1>

    <canvas class="background" width="940" height="529">
      your browser does not support HTML5 Canvas.
    </canvas>

    <form id="formulario">
      <input type="text-box" id="campo" placeholder="Teste selec. alocaçao">
      <input type="submit" id="enviar" value="enviar">
    </form>

  </main>
</body>

</html>

<script>
  //OBJETOS
  const locacoesObj = {
    0: {
      nome: "PH10",
      area: [50, 79, 149, 315],
      disp: true,
      produto: undefined,
    },
    1: {
      nome: "PH20",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    2: {
      nome: "PH30",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    3: {
      nome: "PH40",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    4: {
      nome: "PH50",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    5: {
      nome: "PH101",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    6: {
      nome: "PH102",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    7: {
      nome: "PH103",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    8: {
      nome: "PH104",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    9: {
      nome: "PH201",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    10: {
      nome: "PH202",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    11: {
      nome: "PH203",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    12: {
      nome: "PH204",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    13: {
      nome: "PH301",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    14: {
      nome: "PH302",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    15: {
      nome: "PH303",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    16: {
      nome: "PH304",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    17: {
      nome: "PH401",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    18: {
      nome: "PH402",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    19: {
      nome: "PH403",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    20: {
      nome: "PH404",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    21: {
      nome: "PH501",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    22: {
      nome: "PH502",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    23: {
      nome: "PH503",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    24: {
      nome: "PH504",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    25: {
      nome: "PH505",
      area: undefined,
      disp: true,
      produto: undefined,
    },
    //A e B
    26: {
      nome: "PH101A",
      area: [50, 79, 74, 71],
      disp: false,
      produto: undefined,
    },

    27: {
      nome: "PH101B",
      area: [125, 79, 74, 71],
      disp: false,
      produto: undefined,
    },
    28: {
      nome: "PH102A",
      area: [50, 157, 74, 71],
      disp: false,
      produto: undefined,
    },
    29: {
      nome: "PH102B",
      area: [125, 157, 74, 71],
      disp: false,
      produto: undefined,
    },
  }

  //CANVAS
  var canvas = document.querySelector("canvas");
  var ctx = canvas.getContext("2d");

  var canvas2 = document.createElement('canvas')
  canvas2.setAttribute("width", "940");
  canvas2.setAttribute("height", "529");
  var ctx2 = canvas2.getContext('2d');

  var background = new Image();
  background.src = "estantes.png";

  background.onload = function () {
    ctx.drawImage(background, 0, 0);
    ctx.drawImage(canvas2, 0, 0,);
  }

  //TESTE INPUT

  // //input text-box
  // let form = document.getElementById("formulario")
  // let campo = document.getElementById("campo");

  // form.addEventListener("submit", function (e) {
  //   var teste = campo.value
  //   alert(typeof (teste))
  //   // impede o envio do form
  //   e.preventDefault();
  // });

  //ok
  function tornaIndisp(x, y, w, h, objeto, produto) {
    if (objeto["disp"] == false) {
      ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';
      //ctx2.drawImage(canvas2, 0, 0,)
      ctx.fillRect(x, y, w, h);
      ctx.font = 'bold 13px calibri, sans-serif';
      ctx.fillStyle = 'black';
      ctx.fillText(produto, x + 9, y + h / 1.25);

      console.log(`${objeto["produto"]} oculpa a area!;
      `);
    }
  }

  // NOT OK
  function selecionaArea(evento) {
    let x = evento.pageX - canvas.offsetLeft;
    let y = evento.pageY - canvas.offsetTop;

    for (let i = areasAB; i < arrayObjFilho.length; i++) {
      if (x >= locacoesObj[i]["area"][0] && x <= locacoesObj[i]["area"][0] + locacoesObj[i]["area"][2]
        && y >= locacoesObj[i]["area"][1] && y <= locacoesObj[i]["area"][1] + locacoesObj[i]["area"][3]) {
        
          console.log(`${locacoesObj[i]["nome"]} selecionada!`);
          alert(`${locacoesObj[i]["nome"]} selecionada!`)
        tornaIndisp(...locacoesObj[i]["area"], locacoesObj[i], locacoesObj[i]["produto"])
      }
    }
  }

  //ok
  function listaLoc() {
    for (let i = 0; i < keyList.length; i++) {
      if (arrayObjFilho.length < keyList.length) {
        let objFilho = locacoesObj[i];
        arrayObjFilho.push(objFilho)
      }
    }
    //console.table(arrayObjFilho)
  }

  //VARIAVEIS E CHAMADAS
  let arrayObjFilho = [];
  let keyList = Object.keys(locacoesObj);
  let areasAB = 26;

  listaLoc(); //Gera array de Objestos filhos de locacoesObj em arrayObjFilho.
  canvas.onclick = selecionaArea;

</script>