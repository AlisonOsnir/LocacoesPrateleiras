<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<html lang="pt-br">

<head>
  <title>Locações PTH</title>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="style.css">

</head>

<body>
  <main>
    <h1 class="tituloPrincipal">LOCAÇÕES PTH</h1>

    <canvas class="backgroundimg" width="940" height="529">
      your browser does not support HTML5 Canvas.
    </canvas>

    <form id="formulario">
      <label for="loc" id="labelloc">Locação</label>
      <input type="text" id="loc" name="loc">
      <label for="produto" id="labelcod">Cod. produto</label>
      <input type="text" id="produto" name="produto">
      <p>status do material</p>
      <div class="radio">
        <input type="radio" id="status" name="status" value="Liberado">
        <label for="Liberado">Liberado</label><br>
        <input type="radio" id="status" name="status" value="Produção">
        <label for="Produção" id=>Produção</label><br>
        <input type="radio" id="status" name="status" value="Parado">
        <label for="Parado">Parado</label><br><br>
      </div>

      <input type="submit" id="enviar" value="enviar">

    </form>

  </main>
</body>

</html>

<script>
  //OBJETOS
  const locacoesObj = {
    0: {
      nome: "PH10",
      area: [50, 79, 149, 315],
      disp: true,
      produto: undefined,
    },
    1: {
      nome: "PH20",
      area: [222, 79, 149, 315],
      disp: true,
      produto: undefined,
    },
    2: {
      nome: "PH30",
      area: [394, 79, 149, 315],
      disp: true,
      produto: undefined,
    },
    3: {
      nome: "PH40",
      area: [566, 79, 149, 315],
      disp: true,
      produto: undefined,
    },
    4: {
      nome: "PH50",
      area: [738.7, 79, 149, 315],
      disp: true,
      produto: undefined,
    },
    //PH10
    5: {
      nome: "PH101",
      area: [50, 79, 149, 71],
      disp: true,
      produto: undefined,
    },
    6: {
      nome: "PH102",
      area: [50, 158, 149, 71],
      disp: true,
      produto: undefined,
    },
    7: {
      nome: "PH103",
      area: [50, 237, 149, 71],
      disp: true,
      produto: undefined,
    },
    8: {
      nome: "PH104",
      area: [50, 316, 149, 77],
      disp: true,
      produto: undefined,
    },
    //PH20
    9: {
      nome: "PH201",
      area: [222, 79, 149, 71],
      disp: true,
      produto: undefined,
    },
    10: {
      nome: "PH202",
      area: [222, 158, 149, 71],
      disp: true,
      produto: undefined,
    },
    11: {
      nome: "PH203",
      area: [222, 237, 149, 71],
      disp: true,
      produto: undefined,
    },
    12: {
      nome: "PH204",
      area: [222, 316, 149, 77],
      disp: true,
      produto: undefined,
    },
    //PH30
    13: {
      nome: "PH301",
      area: [394, 79, 149, 71],
      disp: true,
      produto: undefined,
    },
    14: {
      nome: "PH302",
      area: [394, 158, 149, 71],
      disp: true,
      produto: undefined,
    },
    15: {
      nome: "PH303",
      area: [394, 237, 149, 71],
      disp: true,
      produto: undefined,
    },
    16: {
      nome: "PH304",
      area: [394, 316, 149, 77],
      disp: true,
      produto: undefined,
    },
    //PH40
    17: {
      nome: "PH401",
      area: [566, 79, 149, 71],
      disp: true,
      produto: undefined,
    },
    18: {
      nome: "PH402",
      area: [566, 158, 149, 71],
      disp: true,
      produto: undefined,
    },
    19: {
      nome: "PH403",
      area: [566, 237, 149, 71],
      disp: true,
      produto: undefined,
    },
    20: {
      nome: "PH404",
      area: [566, 316, 149, 77],
      disp: true,
      produto: undefined,
    },
    //PH50
    21: {
      nome: "PH501",
      area: [738.7, 79, 149, 55],
      disp: true,
      produto: undefined,
    },
    22: {
      nome: "PH502",
      area: [738.7, 142, 149, 55],
      disp: true,
      produto: undefined,
    },
    23: {
      nome: "PH503",
      area: [738.7, 205, 149, 55],
      disp: true,
      produto: undefined,
    },
    24: {
      nome: "PH504",
      area: [738.7, 268, 149, 55],
      disp: true,
      produto: undefined,
    },
    25: {
      nome: "PH505",
      area: [738.7, 331, 149, 62],
      disp: true,
      produto: undefined,
    },
    //A e B
    //PH10
    26: {
      nome: "PH101A",
      area: [50, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    27: {
      nome: "PH101B",
      area: [125, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    28: {
      nome: "PH102A",
      area: [50, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    29: {
      nome: "PH102B",
      area: [125, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    30: {
      nome: "PH103A",
      area: [50, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    31: {
      nome: "PH103B",
      area: [125, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    32: {
      nome: "PH104A",
      area: [50, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    33: {
      nome: "PH104B",
      area: [125, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    //PH20
    34: {
      nome: "PH201A",
      area: [222, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    35: {
      nome: "PH201B",
      area: [297, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    36: {
      nome: "PH202A",
      area: [222, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    37: {
      nome: "PH202B",
      area: [297, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    38: {
      nome: "PH203A",
      area: [222, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    39: {
      nome: "PH203B",
      area: [297, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    40: {
      nome: "PH204A",
      area: [222, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    41: {
      nome: "PH204B",
      area: [297, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    //PH30
    42: {
      nome: "PH301A",
      area: [394, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    43: {
      nome: "PH301B",
      area: [469, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    44: {
      nome: "PH302A",
      area: [394, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    45: {
      nome: "PH302B",
      area: [469, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    46: {
      nome: "PH303A",
      area: [394, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    47: {
      nome: "PH303B",
      area: [469, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    48: {
      nome: "PH304A",
      area: [394, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    49: {
      nome: "PH304B",
      area: [469, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    //PH40
    50: {
      nome: "PH401A",
      area: [566, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    51: {
      nome: "PH401B",
      area: [641, 79, 74, 71],
      disp: true,
      produto: undefined,
    },
    52: {
      nome: "PH402A",
      area: [566, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    53: {
      nome: "PH402B",
      area: [641, 158, 74, 71],
      disp: true,
      produto: undefined,
    },
    54: {
      nome: "PH403A",
      area: [566, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    55: {
      nome: "PH403B",
      area: [641, 237, 74, 71],
      disp: true,
      produto: undefined,
    },
    56: {
      nome: "PH404A",
      area: [566, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    57: {
      nome: "PH404B",
      area: [641, 316, 74, 77],
      disp: true,
      produto: undefined,
    },
    //PH50
    58: {
      nome: "PH501A",
      area: [738.7, 79, 71, 55],
      disp: true,
      produto: undefined,
    },
    59: {
      nome: "PH501B",
      area: [811.7, 79, 76, 55],
      disp: true,
      produto: undefined,
    },
    60: {
      nome: "PH502A",
      area: [738.7, 142, 71, 55],
      disp: true,
      produto: undefined,
    },
    61: {
      nome: "PH502B",
      area: [811.7, 142, 76, 55],
      disp: true,
      produto: undefined,
    },
    62: {
      nome: "PH503A",
      area: [738.7, 205, 71, 55],
      disp: true,
      produto: undefined,
    },
    63: {
      nome: "PH503B",
      area: [811.7, 205, 76, 55],
      disp: true,
      produto: undefined,
    },
    64: {
      nome: "PH504A",
      area: [738.7, 268, 71, 55],
      disp: true,
      produto: undefined,
    },
    65: {
      nome: "PH504B",
      area: [811.7, 268, 76, 55],
      disp: true,
      produto: undefined,
    },
    66: {
      nome: "PH505A",
      area: [738.7, 331, 71, 62],
      disp: true,
      produto: undefined,
    },
    67: {
      nome: "PH505B",
      area: [811.7, 331, 76, 62],
      disp: true,
      produto: undefined,
    },
  }

  //CANVAS
  var canvas = document.querySelector("canvas");
  var ctx = canvas.getContext("2d");

  var canvas2 = document.createElement('canvas')
  canvas2.setAttribute("width", "940");
  canvas2.setAttribute("height", "529");
  var ctxForaFunction = canvas2.getContext('2d');

  var background = new Image();
  background.src = "estantes.png";

  background.onload = function () {
    ctx.drawImage(background, 0, 0);
    ctx.drawImage(canvas2, 0, 0,);
  }

  //TESTE INPUT

  // //input text-box
  // let form = document.getElementById("formulario")
  // let campo = document.getElementById("campo");

  // form.addEventListener("submit", function (e) {
  //   var teste = campo.value
  //   alert(typeof (teste))
  //   // impede o envio do form
  //   e.preventDefault();
  // });

  function tornaIndisp(x, y, w, h, objeto, produto) {
    if (objeto["disp"] == true) {
      ctx.fillStyle = 'rgba(255, 255, 0, 0.7)';
      //ctx2.drawImage(canvas2, 0, 0,)
      ctx.fillRect(x, y, w, h);
      ctx.font = 'bold 13px calibri, sans-serif';
      ctx.fillStyle = 'black';
      ctx.fillText(produto, x + 9, y + h / 1.25);

      console.log(`${produto} oculpa a area!
      `);
    }
  }

  function selecionaArea(evento) {
    let x = evento.pageX - canvas.offsetLeft;
    let y = evento.pageY - canvas.offsetTop;

    for (let i = areasAB; i < arrayObjFilho.length; i++) {
      if (x >= locacoesObj[i]["area"][0] && x <= locacoesObj[i]["area"][0] + locacoesObj[i]["area"][2]
        && y >= locacoesObj[i]["area"][1] && y <= locacoesObj[i]["area"][1] + locacoesObj[i]["area"][3]) {

        console.log(`${locacoesObj[i]["nome"]} selecionada!`);
        tornaIndisp(...locacoesObj[i]["area"], locacoesObj[i], locacoesObj[i]["produto"])
      }
    }
  }

  function listaLoc() {
    for (let i = 0; i < keyList.length; i++) {
      if (arrayObjFilho.length < keyList.length) {
        let objFilho = locacoesObj[i];
        arrayObjFilho.push(objFilho)
      }
    }
  }

  //VARIAVEIS E CHAMADAS
  let arrayObjFilho = [];
  const keyList = Object.keys(locacoesObj);
  const areasAB = 26;

  listaLoc(); //Gera array de Objestos filhos de locacoesObj em arrayObjFilho.
  canvas.onclick = selecionaArea;

  //console.table(arrayObjFilho)
</script>